CanvasMatrix4=function(a){if("object"==typeof a){if("length"in a&&a.length>=16)return void this.load(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]);if(a instanceof CanvasMatrix4)return void this.load(a)}this.makeIdentity()},CanvasMatrix4.prototype.load=function(){if(1==arguments.length&&"object"==typeof arguments[0]){var a=arguments[0];if("length"in a&&16==a.length)return this.m11=a[0],this.m12=a[1],this.m13=a[2],this.m14=a[3],this.m21=a[4],this.m22=a[5],this.m23=a[6],this.m24=a[7],this.m31=a[8],this.m32=a[9],this.m33=a[10],this.m34=a[11],this.m41=a[12],this.m42=a[13],this.m43=a[14],void(this.m44=a[15]);if(arguments[0]instanceof CanvasMatrix4)return this.m11=a.m11,this.m12=a.m12,this.m13=a.m13,this.m14=a.m14,this.m21=a.m21,this.m22=a.m22,this.m23=a.m23,this.m24=a.m24,this.m31=a.m31,this.m32=a.m32,this.m33=a.m33,this.m34=a.m34,this.m41=a.m41,this.m42=a.m42,this.m43=a.m43,void(this.m44=a.m44)}this.makeIdentity()},CanvasMatrix4.prototype.getAsArray=function(){return[this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.m41,this.m42,this.m43,this.m44]},CanvasMatrix4.prototype.getAsWebGLFloatArray=function(){return new Float32Array(this.getAsArray())},CanvasMatrix4.prototype.makeIdentity=function(){this.m11=1,this.m12=0,this.m13=0,this.m14=0,this.m21=0,this.m22=1,this.m23=0,this.m24=0,this.m31=0,this.m32=0,this.m33=1,this.m34=0,this.m41=0,this.m42=0,this.m43=0,this.m44=1},CanvasMatrix4.prototype.transpose=function(){var a=this.m12;this.m12=this.m21,this.m21=a,a=this.m13,this.m13=this.m31,this.m31=a,a=this.m14,this.m14=this.m41,this.m41=a,a=this.m23,this.m23=this.m32,this.m32=a,a=this.m24,this.m24=this.m42,this.m42=a,a=this.m34,this.m34=this.m43,this.m43=a},CanvasMatrix4.prototype.invert=function(){var a=this._determinant4x4();return Math.abs(a)<1e-8?null:(this._makeAdjoint(),this.m11/=a,this.m12/=a,this.m13/=a,this.m14/=a,this.m21/=a,this.m22/=a,this.m23/=a,this.m24/=a,this.m31/=a,this.m32/=a,this.m33/=a,this.m34/=a,this.m41/=a,this.m42/=a,this.m43/=a,void(this.m44/=a))},CanvasMatrix4.prototype.translate=function(a,b,c){void 0==a&&(a=0),void 0==b&&(b=0),void 0==c&&(c=0);var d=new CanvasMatrix4;d.m41=a,d.m42=b,d.m43=c,this.multRight(d)},CanvasMatrix4.prototype.scale=function(a,b,c){void 0==a&&(a=1),void 0==c?void 0==b?(b=a,c=a):c=1:void 0==b&&(b=a);var d=new CanvasMatrix4;d.m11=a,d.m22=b,d.m33=c,this.multRight(d)},CanvasMatrix4.prototype.rotate=function(a,b,c,d){a=a/180*Math.PI,a/=2;var e=Math.sin(a),f=Math.cos(a),g=e*e,h=Math.sqrt(b*b+c*c+d*d);0==h?(b=0,c=0,d=1):1!=h&&(b/=h,c/=h,d/=h);var i=new CanvasMatrix4;if(1==b&&0==c&&0==d)i.m11=1,i.m12=0,i.m13=0,i.m21=0,i.m22=1-2*g,i.m23=2*e*f,i.m31=0,i.m32=-2*e*f,i.m33=1-2*g,i.m14=i.m24=i.m34=0,i.m41=i.m42=i.m43=0,i.m44=1;else if(0==b&&1==c&&0==d)i.m11=1-2*g,i.m12=0,i.m13=-2*e*f,i.m21=0,i.m22=1,i.m23=0,i.m31=2*e*f,i.m32=0,i.m33=1-2*g,i.m14=i.m24=i.m34=0,i.m41=i.m42=i.m43=0,i.m44=1;else if(0==b&&0==c&&1==d)i.m11=1-2*g,i.m12=2*e*f,i.m13=0,i.m21=-2*e*f,i.m22=1-2*g,i.m23=0,i.m31=0,i.m32=0,i.m33=1,i.m14=i.m24=i.m34=0,i.m41=i.m42=i.m43=0,i.m44=1;else{var j=b*b,k=c*c,l=d*d;i.m11=1-2*(k+l)*g,i.m12=2*(b*c*g+d*e*f),i.m13=2*(b*d*g-c*e*f),i.m21=2*(c*b*g-d*e*f),i.m22=1-2*(l+j)*g,i.m23=2*(c*d*g+b*e*f),i.m31=2*(d*b*g+c*e*f),i.m32=2*(d*c*g-b*e*f),i.m33=1-2*(j+k)*g,i.m14=i.m24=i.m34=0,i.m41=i.m42=i.m43=0,i.m44=1}this.multRight(i)},CanvasMatrix4.prototype.multRight=function(a){var b=this.m11*a.m11+this.m12*a.m21+this.m13*a.m31+this.m14*a.m41,c=this.m11*a.m12+this.m12*a.m22+this.m13*a.m32+this.m14*a.m42,d=this.m11*a.m13+this.m12*a.m23+this.m13*a.m33+this.m14*a.m43,e=this.m11*a.m14+this.m12*a.m24+this.m13*a.m34+this.m14*a.m44,f=this.m21*a.m11+this.m22*a.m21+this.m23*a.m31+this.m24*a.m41,g=this.m21*a.m12+this.m22*a.m22+this.m23*a.m32+this.m24*a.m42,h=this.m21*a.m13+this.m22*a.m23+this.m23*a.m33+this.m24*a.m43,i=this.m21*a.m14+this.m22*a.m24+this.m23*a.m34+this.m24*a.m44,j=this.m31*a.m11+this.m32*a.m21+this.m33*a.m31+this.m34*a.m41,k=this.m31*a.m12+this.m32*a.m22+this.m33*a.m32+this.m34*a.m42,l=this.m31*a.m13+this.m32*a.m23+this.m33*a.m33+this.m34*a.m43,m=this.m31*a.m14+this.m32*a.m24+this.m33*a.m34+this.m34*a.m44,n=this.m41*a.m11+this.m42*a.m21+this.m43*a.m31+this.m44*a.m41,o=this.m41*a.m12+this.m42*a.m22+this.m43*a.m32+this.m44*a.m42,p=this.m41*a.m13+this.m42*a.m23+this.m43*a.m33+this.m44*a.m43,q=this.m41*a.m14+this.m42*a.m24+this.m43*a.m34+this.m44*a.m44;this.m11=b,this.m12=c,this.m13=d,this.m14=e,this.m21=f,this.m22=g,this.m23=h,this.m24=i,this.m31=j,this.m32=k,this.m33=l,this.m34=m,this.m41=n,this.m42=o,this.m43=p,this.m44=q},CanvasMatrix4.prototype.multLeft=function(a){var b=a.m11*this.m11+a.m12*this.m21+a.m13*this.m31+a.m14*this.m41,c=a.m11*this.m12+a.m12*this.m22+a.m13*this.m32+a.m14*this.m42,d=a.m11*this.m13+a.m12*this.m23+a.m13*this.m33+a.m14*this.m43,e=a.m11*this.m14+a.m12*this.m24+a.m13*this.m34+a.m14*this.m44,f=a.m21*this.m11+a.m22*this.m21+a.m23*this.m31+a.m24*this.m41,g=a.m21*this.m12+a.m22*this.m22+a.m23*this.m32+a.m24*this.m42,h=a.m21*this.m13+a.m22*this.m23+a.m23*this.m33+a.m24*this.m43,i=a.m21*this.m14+a.m22*this.m24+a.m23*this.m34+a.m24*this.m44,j=a.m31*this.m11+a.m32*this.m21+a.m33*this.m31+a.m34*this.m41,k=a.m31*this.m12+a.m32*this.m22+a.m33*this.m32+a.m34*this.m42,l=a.m31*this.m13+a.m32*this.m23+a.m33*this.m33+a.m34*this.m43,m=a.m31*this.m14+a.m32*this.m24+a.m33*this.m34+a.m34*this.m44,n=a.m41*this.m11+a.m42*this.m21+a.m43*this.m31+a.m44*this.m41,o=a.m41*this.m12+a.m42*this.m22+a.m43*this.m32+a.m44*this.m42,p=a.m41*this.m13+a.m42*this.m23+a.m43*this.m33+a.m44*this.m43,q=a.m41*this.m14+a.m42*this.m24+a.m43*this.m34+a.m44*this.m44;this.m11=b,this.m12=c,this.m13=d,this.m14=e,this.m21=f,this.m22=g,this.m23=h,this.m24=i,this.m31=j,this.m32=k,this.m33=l,this.m34=m,this.m41=n,this.m42=o,this.m43=p,this.m44=q},CanvasMatrix4.prototype.ortho=function(a,b,c,d,e,f){var g=(a+b)/(a-b),h=(d+c)/(d-c),i=(f+e)/(f-e),j=new CanvasMatrix4;j.m11=2/(a-b),j.m12=0,j.m13=0,j.m14=0,j.m21=0,j.m22=2/(d-c),j.m23=0,j.m24=0,j.m31=0,j.m32=0,j.m33=-2/(f-e),j.m34=0,j.m41=g,j.m42=h,j.m43=i,j.m44=1,this.multRight(j)},CanvasMatrix4.prototype.frustum=function(a,b,c,d,e,f){var g=new CanvasMatrix4,h=(b+a)/(b-a),i=(d+c)/(d-c),j=-(f+e)/(f-e),k=-(2*f*e)/(f-e);g.m11=2*e/(b-a),g.m12=0,g.m13=0,g.m14=0,g.m21=0,g.m22=2*e/(d-c),g.m23=0,g.m24=0,g.m31=h,g.m32=i,g.m33=j,g.m34=-1,g.m41=0,g.m42=0,g.m43=k,g.m44=0,this.multRight(g)},CanvasMatrix4.prototype.perspective=function(a,b,c,d){var e=Math.tan(a*Math.PI/360)*c,f=-e,g=b*f,h=b*e;this.frustum(g,h,f,e,c,d)},CanvasMatrix4.prototype.lookat=function(a,b,c,d,e,f,g,h,i){var j=new CanvasMatrix4,k=a-d,l=b-e,m=c-f,n=Math.sqrt(k*k+l*l+m*m);n&&(k/=n,l/=n,m/=n);var o=g,p=h,q=i;xx=p*m-q*l,xy=-o*m+q*k,xz=o*l-p*k,o=l*xz-m*xy,p=-k*xz+m*xx,o=k*xy-l*xx,n=Math.sqrt(xx*xx+xy*xy+xz*xz),n&&(xx/=n,xy/=n,xz/=n),n=Math.sqrt(o*o+p*p+q*q),n&&(o/=n,p/=n,q/=n),j.m11=xx,j.m12=xy,j.m13=xz,j.m14=0,j.m21=o,j.m22=p,j.m23=q,j.m24=0,j.m31=k,j.m32=l,j.m33=m,j.m34=0,j.m41=0,j.m42=0,j.m43=0,j.m44=1,j.translate(-a,-b,-c),this.multRight(j)},CanvasMatrix4.prototype._determinant2x2=function(a,b,c,d){return a*d-b*c},CanvasMatrix4.prototype._determinant3x3=function(a,b,c,d,e,f,g,h,i){return a*this._determinant2x2(e,f,h,i)-d*this._determinant2x2(b,c,h,i)+g*this._determinant2x2(b,c,e,f)},CanvasMatrix4.prototype._determinant4x4=function(){var a=this.m11,b=this.m12,c=this.m13,d=this.m14,e=this.m21,f=this.m22,g=this.m23,h=this.m24,i=this.m31,j=this.m32,k=this.m33,l=this.m34,m=this.m41,n=this.m42,o=this.m43,p=this.m44;return a*this._determinant3x3(f,j,n,g,k,o,h,l,p)-b*this._determinant3x3(e,i,m,g,k,o,h,l,p)+c*this._determinant3x3(e,i,m,f,j,n,h,l,p)-d*this._determinant3x3(e,i,m,f,j,n,g,k,o)},CanvasMatrix4.prototype._makeAdjoint=function(){var a=this.m11,b=this.m12,c=this.m13,d=this.m14,e=this.m21,f=this.m22,g=this.m23,h=this.m24,i=this.m31,j=this.m32,k=this.m33,l=this.m34,m=this.m41,n=this.m42,o=this.m43,p=this.m44;this.m11=this._determinant3x3(f,j,n,g,k,o,h,l,p),this.m21=-this._determinant3x3(e,i,m,g,k,o,h,l,p),this.m31=this._determinant3x3(e,i,m,f,j,n,h,l,p),this.m41=-this._determinant3x3(e,i,m,f,j,n,g,k,o),this.m12=-this._determinant3x3(b,j,n,c,k,o,d,l,p),this.m22=this._determinant3x3(a,i,m,c,k,o,d,l,p),this.m32=-this._determinant3x3(a,i,m,b,j,n,d,l,p),this.m42=this._determinant3x3(a,i,m,b,j,n,c,k,o),this.m13=this._determinant3x3(b,f,n,c,g,o,d,h,p),this.m23=-this._determinant3x3(a,e,m,c,g,o,d,h,p),this.m33=this._determinant3x3(a,e,m,b,f,n,d,h,p),this.m43=-this._determinant3x3(a,e,m,b,f,n,c,g,o),this.m14=-this._determinant3x3(b,f,j,c,g,k,d,h,l),this.m24=this._determinant3x3(a,e,i,c,g,k,d,h,l),this.m34=-this._determinant3x3(a,e,i,b,f,j,d,h,l),this.m44=this._determinant3x3(a,e,i,b,f,j,c,g,k)};var ZERO={};ZERO.Scene=function(){this.lights=[],this.meshes=[]},ZERO.Scene.prototype.add=function(a){"light"===a.type?this.lights.push(a):"mesh"===a.type&&this.meshes.push(a)},ZERO.PerspectiveCamera=function(a,b,c,d){this.fov=a,this.aspect=b,this.near=c,this.far=d,this.position=new ZERO.Position,this.angle=0},ZERO.PerspectiveCamera.prototype.rotateOnZAxis=function(a){this.angle=a},ZERO.PerspectiveCamera.prototype.rotate=ZERO.PerspectiveCamera.prototype.rotateOnZAxis,ZERO.PerspectiveCamera.prototype.setPerspective=function(a){return a||(a=new CanvasMatrix4),a.rotate(this.angle,0,0,1),a.translate(this.position.x,this.position.y,this.position.z),a.perspective(this.fov,this.aspect,this.near,this.far),a},ZERO.WebGLRenderer=function(){this.domElement=null,this.gl=null,this.program=null,this.ibuffer=null,this.vbuffers=null,this.numIndices=0,this.uniformVars=null},ZERO.WebGLRenderer.VSHADER_SOURCE="#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 mvpMatrix;\nuniform mat4 normalMatrix;\nuniform vec4 lightVec;\nuniform vec4 lightColor;\nuniform vec4 materialColor;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\nvarying vec4 color;\nvarying vec2 texCoord;\n\nvoid main() {\n  vec3  n     = (normalMatrix * vec4(normal, 0.0)).xyz;\n  float light = clamp(dot(n, lightVec.xyz), 0.0, 1.0) * 0.8 + 0.2;\n  color       = min(min(materialColor, lightColor), vec4(light, light, light, 1.0));\n  texCoord    = uv;\n  gl_Position = mvpMatrix * vec4(position, 1.0);\n}",ZERO.WebGLRenderer.FSHADER_SOURCE="#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D texture;\n\nvarying vec4 color;\nvarying vec2 texCoord;\n\nvoid main() {\n  //gl_FragColor = texture2D(texture, texCoord) * color;\n  gl_FragColor = color;\n}",ZERO.WebGLRenderer.prototype.setSize=function(a,b){if(this.domElement=document.createElement("canvas"),this.domElement.width=a,this.domElement.height=b,this.gl=this.domElement.getContext("webgl")||this.domElement.getContext("experimental-webgl"),!this.gl)throw"WebGL is not supported."},ZERO.WebGLRenderer.prototype.render=function(a,b){var c;for(c=0;c<a.meshes.length;c++){var d=a.meshes[c].geometry;d.build(b.position.z/500),this._initVertices(d),this._initIndices(d),this._initTexture(),this._initShaders()}this.gl.clearColor(0,0,0,1),this.gl.clearDepth(b.far),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.enable(this.gl.DEPTH_TEST),this.gl.useProgram(this.program);var e=[0,0,0,0],f=ZERO.Utils.getRGB(0);if(a.lights&&0<a.lights.length){var g=a.lights[0];e=[g.position.x,g.position.y,-g.position.z,0],f=g.getColor()}var h=new CanvasMatrix4,i=new CanvasMatrix4(h);b.setPerspective(i);var j=new CanvasMatrix4(h);j.invert(),j.transpose();var k=a.meshes[0].material.getColor(),l=[i,j,e,f,k];for(c=0;c<l.length;c++){var m=l[c];m instanceof CanvasMatrix4?this.gl.uniformMatrix4fv(this.uniformVars[c],!1,m.getAsWebGLFloatArray()):this.gl.uniform4fv(this.uniformVars[c],new Float32Array(m))}var n=[3,3,2];for(c=0;c<n.length;c++){var o=n[c];this.gl.enableVertexAttribArray(c),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbuffers[c]),this.gl.vertexAttribPointer(c,o,this.gl.FLOAT,!1,0,0)}this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.ibuffer),this.gl.drawElements(this.gl.TRIANGLES,this.numIndices,this.gl.UNSIGNED_SHORT,0),this.gl.flush()},ZERO.WebGLRenderer.prototype._initVertices=function(a){this.vbuffers=[a.positions,a.positions,a.uvs];for(var b=0;b<this.vbuffers.length;b++){var c=this.vbuffers[b],d=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,d),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(c),this.gl.STATIC_DRAW),this.vbuffers[b]=d}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},ZERO.WebGLRenderer.prototype._initIndices=function(a){this.ibuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.ibuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Int16Array(a.indices),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.numIndices=a.indices.length},ZERO.WebGLRenderer.prototype._initTexture=function(){},ZERO.WebGLRenderer.prototype._initShaders=function(){var a=this.gl.createShader(this.gl.VERTEX_SHADER);if(this.gl.shaderSource(a,ZERO.WebGLRenderer.VSHADER_SOURCE),this.gl.compileShader(a),!this.gl.getShaderParameter(a,this.gl.COMPILE_STATUS))throw this.gl.getShaderInfoLog(a);var b=this.gl.createShader(this.gl.FRAGMENT_SHADER);if(this.gl.shaderSource(b,ZERO.WebGLRenderer.FSHADER_SOURCE),this.gl.compileShader(b),!this.gl.getShaderParameter(b,this.gl.COMPILE_STATUS))throw this.gl.getShaderInfoLog(b);if(this.program=this.gl.createProgram(),this.gl.attachShader(this.program,a),this.gl.attachShader(this.program,b),this.gl.bindAttribLocation(this.program,0,"position"),this.gl.bindAttribLocation(this.program,1,"normal"),this.gl.bindAttribLocation(this.program,2,"uv"),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw this.gl.getProgramInfoLog(this.program);this.uniformVars=[this.gl.getUniformLocation(this.program,"mvpMatrix"),this.gl.getUniformLocation(this.program,"normalMatrix"),this.gl.getUniformLocation(this.program,"lightVec"),this.gl.getUniformLocation(this.program,"lightColor"),this.gl.getUniformLocation(this.program,"materialColor")]},ZERO.DirectionalLight=function(a){this.type="light",this.color=a,this.position=new ZERO.Position},ZERO.DirectionalLight.prototype.getColor=function(){return ZERO.Utils.getRGB(this.color)},ZERO.PointGeometry=function(){this.positions=null,this.uvs=null,this.indices=null},ZERO.PointGeometry.prototype.build=function(a){var b,c;for(a=Math.abs(a),this.positions=[],this.uvs=[],this.indices=[],b=0;8>=b;++b){var d=b/8,e=Math.cos(Math.PI*d)*a,f=Math.sin(Math.PI*d)*a;for(c=0;16>=c;++c){var g=c/16;this.positions=this.positions.concat(Math.cos(2*Math.PI*g)*f,e,Math.sin(2*Math.PI*g)*f),this.uvs=this.uvs.concat(g,d)}}for(c=0;8>c;++c){var h=17*c;for(b=0;16>b;++b)this.indices=this.indices.concat(h+b,h+b+1,h+b+17,h+b+17,h+b+1,h+b+1+17)}},ZERO.MeshBasicMaterial=function(a){this.props=a||{}},ZERO.MeshBasicMaterial.prototype.getColor=function(){return ZERO.Utils.getRGB(this.props.color||16777215)},ZERO.Mesh=function(a,b){this.type="mesh",this.geometry=a,this.material=b},ZERO.Position=function(a){this.x=0,this.y=0,this.set(a)},ZERO.Position.prototype.set=function(a){this.z=-Math.abs(a||0)},ZERO.Utils={getRGB:function(a){var b=(a>>16)/255,c=((65280&a)>>8)/255,d=(255&a)/255;return[b,c,d,1]}};